import{m as oe}from"./VSelect-8600eec3.js";import{f as ie}from"./forwardRefs-a29b5f65.js";import{m as se,u as re}from"./filter-a3cf0501.js";import{m as ce}from"./transition-0c6e30e4.js";import{u as ve,t as R,V as de,a as $}from"./VList-d87f0460.js";import{d as fe}from"./VInput-cd4c7816.js";import{aw as me,bg as be,bi as he,k as V,aX as j,a0 as h,b9 as ye,c2 as ge,w as S,aT as z,aN as xe,C as i,F as X,s as D,b0 as pe,t as ke}from"./index-30b66760.js";import{m as Ve,V as H}from"./VTextField-1e90003c.js";import{V as Ce}from"./VMenu-55b2ccf7.js";import{V as we}from"./VCheckboxBtn-a5502da0.js";import{V as _e}from"./VChip-ca3f8676.js";function De(e,m,I){if(m==null)return e;if(Array.isArray(m))throw new Error("Multiple matches is not implemented");return typeof m=="number"&&~m?i(X,null,[i("span",{class:"v-combobox__unmask"},[e.substr(0,m)]),i("span",{class:"v-combobox__mask"},[e.substr(m,I)]),i("span",{class:"v-combobox__unmask"},[e.substr(m+I)])]):e}const Ue=me()({name:"VCombobox",props:{delimiters:Array,...se({filterKeys:["title"]}),...oe({hideNoData:!0,returnObject:!0}),...be(Ve({modelValue:null}),["validationValue","dirty","appendInnerIcon"]),...ce({transition:!1})},emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,m){var K;let{emit:I,slots:t}=m;const{t:q}=he(),y=V(),g=V(!1),x=V(!0),O=V(),T=j(e,"menu"),v=h({get:()=>T.value,set:l=>{var a;T.value&&!l&&((a=O.value)!=null&&a.Î¨openChildren)||(T.value=l)}}),n=V(-1);let E=!1;const G=h(()=>{var l;return(l=y.value)==null?void 0:l.color}),{items:M,transformIn:J,transformOut:Q}=ve(e),{textColorClasses:W,textColorStyles:Y}=ye(G),c=j(e,"modelValue",[],l=>J(ge(l)),l=>{const a=Q(l);return e.multiple?a:a[0]??null}),C=fe(),w=V(e.multiple?"":((K=c.value[0])==null?void 0:K.title)??""),s=h({get:()=>w.value,set:l=>{var a;if(w.value=l,e.multiple||(c.value=[R(e,l)]),l&&e.multiple&&((a=e.delimiters)!=null&&a.length)){const r=l.split(new RegExp(`(?:${e.delimiters.join("|")})+`));r.length>1&&(r.forEach(b=>{b=b.trim(),b&&k(R(e,b))}),w.value="")}l||(n.value=-1),x.value=!l}});S(w,l=>{E?z(()=>E=!1):g.value&&!v.value&&(v.value=!0),I("update:search",l)}),S(c,l=>{var a;e.multiple||(w.value=((a=l[0])==null?void 0:a.title)??"")});const{filteredItems:F,getMatches:Z}=re(e,M,h(()=>x.value?void 0:s.value)),p=h(()=>c.value.map(l=>M.value.find(a=>e.valueComparator(a.value,l.value))||l)),N=h(()=>e.hideSelected?F.value.filter(l=>!p.value.some(a=>a.value===l.value)):F.value),L=h(()=>p.value.map(l=>l.props.value)),B=h(()=>p.value[n.value]),U=V();function ee(l){E=!0,e.openOnClear&&(v.value=!0)}function le(){e.hideNoData&&!M.value.length||e.readonly||C!=null&&C.isReadonly.value||(v.value=!0)}function ae(l){var b,u;if(e.readonly||C!=null&&C.isReadonly.value)return;const a=y.value.selectionStart,r=L.value.length;if((n.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(v.value=!0),["Escape"].includes(l.key)&&(v.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(x.value=!0),l.key==="ArrowDown"?(b=U.value)==null||b.focus("next"):l.key==="ArrowUp"&&((u=U.value)==null||u.focus("prev")),!!e.multiple){if(["Backspace","Delete"].includes(l.key)){if(n.value<0){l.key==="Backspace"&&!s.value&&(n.value=r-1);return}const o=n.value;B.value&&k(B.value),n.value=o>=r-1?r-2:o}if(l.key==="ArrowLeft"){if(n.value<0&&a>0)return;const o=n.value>-1?n.value-1:r-1;p.value[o]?n.value=o:(n.value=-1,y.value.setSelectionRange(s.value.length,s.value.length))}if(l.key==="ArrowRight"){if(n.value<0)return;const o=n.value+1;p.value[o]?n.value=o:(n.value=-1,y.value.setSelectionRange(0,0))}l.key==="Enter"&&s.value&&(k(R(e,s.value)),s.value="")}}function te(){g.value&&(x.value=!0)}function k(l){if(e.multiple){const a=L.value.findIndex(r=>e.valueComparator(r,l.value));if(a===-1)c.value=[...c.value,l];else{const r=[...c.value];r.splice(a,1),c.value=r}s.value=""}else c.value=[l],w.value=l.title,z(()=>{v.value=!1,x.value=!0})}function ue(l){g.value=!0}function ne(l){var a;l.relatedTarget==null&&((a=y.value)==null||a.focus())}return S(F,l=>{!l.length&&e.hideNoData&&(v.value=!1)}),S(g,l=>{if(l)n.value=-1;else{if(v.value=!1,!e.multiple||!s.value)return;c.value=[...c.value,R(e,s.value)],s.value=""}}),xe(()=>{const l=!!(e.chips||t.chip),a=!!(!e.hideNoData||N.value.length||t.prepend||t.append||t["no-data"]),r=c.value.length>0,[b]=H.filterProps(e);return i(H,D({ref:y},b,{modelValue:s.value,"onUpdate:modelValue":[u=>s.value=u,u=>{u==null&&(c.value=[])}],focused:g.value,"onUpdate:focused":u=>g.value=u,validationValue:c.externalValue,dirty:r,class:["v-combobox",{"v-combobox--active-menu":v.value,"v-combobox--chips":!!e.chips,"v-combobox--selecting-index":n.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,appendInnerIcon:e.items.length?e.menuIcon:void 0,readonly:e.readonly,placeholder:r?void 0:e.placeholder,"onClick:clear":ee,"onMousedown:control":le,onKeydown:ae}),{...t,default:()=>i(X,null,[i(Ce,D({ref:O,modelValue:v.value,"onUpdate:modelValue":u=>v.value=u,activator:"parent",contentClass:"v-combobox__content",eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:te},e.menuProps),{default:()=>[a&&i(de,{ref:U,selected:L.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:u=>u.preventDefault(),onFocusin:ue,onFocusout:ne},{default:()=>{var u,o,A;return[!N.value.length&&!e.hideNoData&&(((u=t["no-data"])==null?void 0:u.call(t))??i($,{title:q(e.noDataText)},null)),(o=t["prepend-item"])==null?void 0:o.call(t),N.value.map(d=>{var _;return((_=t.item)==null?void 0:_.call(t,{item:d,props:D(d.props,{onClick:()=>k(d)})}))??i($,D({key:d.value},d.props,{onClick:()=>k(d)}),{prepend:f=>{let{isSelected:P}=f;return e.multiple&&!e.hideSelected?i(we,{modelValue:P,ripple:!1,tabindex:"-1"},null):void 0},title:()=>{var f,P;return x.value?d.title:De(d.title,(f=Z(d))==null?void 0:f.title,((P=s.value)==null?void 0:P.length)??0)}})}),(A=t["append-item"])==null?void 0:A.call(t)]}})]}),p.value.map((u,o)=>{var _;function A(f){f.stopPropagation(),f.preventDefault(),k(u)}const d={"onClick:close":A,modelValue:!0,"onUpdate:modelValue":void 0};return i("div",{key:u.value,class:["v-combobox__selection",o===n.value&&["v-combobox__selection--selected",W.value]],style:o===n.value?Y.value:{}},[l?t.chip?i(pe,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:u.title}}},{default:()=>{var f;return[(f=t.chip)==null?void 0:f.call(t,{item:u,index:o,props:d})]}}):i(_e,D({key:"chip",closable:e.closableChips,size:"small",text:u.title},d),null):((_=t.selection)==null?void 0:_.call(t,{item:u,index:o}))??i("span",{class:"v-combobox__selection-text"},[u.title,e.multiple&&o<p.value.length-1&&i("span",{class:"v-combobox__selection-comma"},[ke(",")])])])})])})}),ie({isFocused:g,isPristine:x,menu:v,search:s,selectionIndex:n,filteredItems:F,select:k},y)}});export{Ue as V};
