import{m as te}from"./VSelect-8600eec3.js";import{f as ue}from"./forwardRefs-a29b5f65.js";import{m as ne,u as oe}from"./filter-a3cf0501.js";import{m as se}from"./transition-0c6e30e4.js";import{d as ie}from"./VInput-cd4c7816.js";import{u as re,V as ce,a as U}from"./VList-d87f0460.js";import{aw as ve,bg as de,bi as fe,k,aX as L,a0 as C,b9 as me,c2 as pe,w as O,aT as B,aN as he,C as s,F as z,s as b,b0 as ye,t as ge}from"./index-30b66760.js";import{m as Ve,V as K}from"./VTextField-1e90003c.js";import{V as ke}from"./VMenu-55b2ccf7.js";import{V as Ce}from"./VCheckboxBtn-a5502da0.js";import{V as we}from"./VChip-ca3f8676.js";function xe(e,f,a){if(f==null)return e;if(Array.isArray(f))throw new Error("Multiple matches is not implemented");return typeof f=="number"&&~f?s(z,null,[s("span",{class:"v-autocomplete__unmask"},[e.substr(0,f)]),s("span",{class:"v-autocomplete__mask"},[e.substr(f,a)]),s("span",{class:"v-autocomplete__unmask"},[e.substr(f+a)])]):e}const Le=ve()({name:"VAutocomplete",props:{search:String,...ne({filterKeys:["title"]}),...te(),...de(Ve({modelValue:null}),["validationValue","dirty","appendInnerIcon"]),...se({transition:!1})},emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,f){let{slots:a}=f;const{t:$}=fe(),y=k(),g=k(!1),p=k(!0),E=k(),S=L(e,"menu"),c=C({get:()=>S.value,set:l=>{var t;S.value&&!l&&((t=E.value)!=null&&t.Î¨openChildren)||(S.value=l)}}),o=k(-1),H=C(()=>{var l;return(l=y.value)==null?void 0:l.color}),{items:D,transformIn:X,transformOut:j}=re(e),{textColorClasses:q,textColorStyles:G}=me(H),i=L(e,"search",""),m=L(e,"modelValue",[],l=>X(pe(l)),l=>{const t=j(l);return e.multiple?t:t[0]??null}),w=ie(),{filteredItems:P,getMatches:J}=oe(e,D,C(()=>p.value?void 0:i.value)),h=C(()=>m.value.map(l=>D.value.find(t=>e.valueComparator(t.value,l.value))||l)),R=C(()=>e.hideSelected?P.value.filter(l=>!h.value.some(t=>t.value===l.value)):P.value),T=C(()=>h.value.map(l=>l.props.value)),N=C(()=>h.value[o.value]),M=k();function Q(l){e.openOnClear&&(c.value=!0),i.value=""}function W(){e.hideNoData&&!D.value.length||e.readonly||w!=null&&w.isReadonly.value||(c.value=!0)}function Y(l){var A,u,v,V;if(e.readonly||w!=null&&w.isReadonly.value)return;const t=y.value.selectionStart,r=T.value.length;if((o.value>-1||["Enter","ArrowDown","ArrowUp"].includes(l.key))&&l.preventDefault(),["Enter","ArrowDown"].includes(l.key)&&(c.value=!0),["Escape"].includes(l.key)&&(c.value=!1),["Enter","Escape","Tab"].includes(l.key)&&(p.value=!0),l.key==="ArrowDown"?(A=M.value)==null||A.focus("next"):l.key==="ArrowUp"&&((u=M.value)==null||u.focus("prev")),!!e.multiple){if(["Backspace","Delete"].includes(l.key)){if(o.value<0){l.key==="Backspace"&&!i.value&&(o.value=r-1);return}const n=o.value;N.value&&_(N.value),o.value=n>=r-1?r-2:n}if(l.key==="ArrowLeft"){if(o.value<0&&t>0)return;const n=o.value>-1?o.value-1:r-1;h.value[n]?o.value=n:(o.value=-1,y.value.setSelectionRange((v=i.value)==null?void 0:v.length,(V=i.value)==null?void 0:V.length))}if(l.key==="ArrowRight"){if(o.value<0)return;const n=o.value+1;h.value[n]?o.value=n:(o.value=-1,y.value.setSelectionRange(0,0))}}}function Z(l){i.value=l.target.value}function ee(){g.value&&(p.value=!0)}function le(l){g.value=!0}function ae(l){var t;l.relatedTarget==null&&((t=y.value)==null||t.focus())}const x=k(!1);function _(l){if(e.multiple){const t=T.value.findIndex(r=>e.valueComparator(r,l.value));if(t===-1)m.value=[...m.value,l];else{const r=[...m.value];r.splice(t,1),m.value=r}}else m.value=[l],x.value=!0,a.selection||(i.value=l.title),c.value=!1,p.value=!0,B(()=>x.value=!1)}return O(g,l=>{var t;l?(x.value=!0,i.value=e.multiple||a.selection?"":String(((t=h.value.at(-1))==null?void 0:t.props.title)??""),p.value=!0,B(()=>x.value=!1)):(c.value=!1,i.value="")}),O(i,l=>{!g.value||x.value||(l&&(c.value=!0),p.value=!l)}),he(()=>{const l=!!(e.chips||a.chip),t=!!(!e.hideNoData||R.value.length||a.prepend||a.append||a["no-data"]),r=m.value.length>0,[A]=K.filterProps(e);return s(K,b({ref:y},A,{modelValue:i.value,"onUpdate:modelValue":u=>{u==null&&(m.value=[])},focused:g.value,"onUpdate:focused":u=>g.value=u,validationValue:m.externalValue,dirty:r,onInput:Z,class:["v-autocomplete",{"v-autocomplete--active-menu":c.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selecting-index":o.value>-1,[`v-autocomplete--${e.multiple?"multiple":"single"}`]:!0,"v-autocomplete--selection-slot":!!a.selection},e.class],style:e.style,appendInnerIcon:e.menuIcon,readonly:e.readonly,placeholder:r?void 0:e.placeholder,"onClick:clear":Q,"onMousedown:control":W,onKeydown:Y}),{...a,default:()=>s(z,null,[s(ke,b({ref:E,modelValue:c.value,"onUpdate:modelValue":u=>c.value=u,activator:"parent",contentClass:"v-autocomplete__content",eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterLeave:ee},e.menuProps),{default:()=>[t&&s(ce,{ref:M,selected:T.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:u=>u.preventDefault(),onFocusin:le,onFocusout:ae},{default:()=>{var u,v,V;return[!R.value.length&&!e.hideNoData&&(((u=a["no-data"])==null?void 0:u.call(a))??s(U,{title:$(e.noDataText)},null)),(v=a["prepend-item"])==null?void 0:v.call(a),R.value.map(n=>{var I;return((I=a.item)==null?void 0:I.call(a,{item:n,props:b(n.props,{onClick:()=>_(n)})}))??s(U,b({key:n.value},n.props,{onClick:()=>_(n)}),{prepend:d=>{let{isSelected:F}=d;return e.multiple&&!e.hideSelected?s(Ce,{modelValue:F,ripple:!1,tabindex:"-1"},null):void 0},title:()=>{var d,F;return p.value?n.title:xe(n.title,(d=J(n))==null?void 0:d.title,((F=i.value)==null?void 0:F.length)??0)}})}),(V=a["append-item"])==null?void 0:V.call(a)]}})]}),h.value.map((u,v)=>{var I;function V(d){d.stopPropagation(),d.preventDefault(),_(u)}const n={"onClick:close":V,modelValue:!0,"onUpdate:modelValue":void 0};return s("div",{key:u.value,class:["v-autocomplete__selection",v===o.value&&["v-autocomplete__selection--selected",q.value]],style:v===o.value?G.value:{}},[l?a.chip?s(ye,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:u.title}}},{default:()=>{var d;return[(d=a.chip)==null?void 0:d.call(a,{item:u,index:v,props:n})]}}):s(we,b({key:"chip",closable:e.closableChips,size:"small",text:u.title},n),null):((I=a.selection)==null?void 0:I.call(a,{item:u,index:v}))??s("span",{class:"v-autocomplete__selection-text"},[u.title,e.multiple&&v<h.value.length-1&&s("span",{class:"v-autocomplete__selection-comma"},[ge(",")])])])})])})}),ue({isFocused:g,isPristine:p,menu:c,search:i,filteredItems:P,select:_},y)}});export{Le as V};
